/*! release-manager 2019-12-11 */

var App=function(t){"use strict";return t.releaseManager=function(){return t.config(),this.redirect=function(t){var e=t.url;for(var n in delete t.url,t)e+=n+"="+t[n]+"&";e=e.substr(0,-1),location.href=e},{redirect:this.redirect}},t}((App=function(t){"use strict";return t.notifier=function(){return this.notifierConfig={animation:!0,delay:{show:250,hide:500},html:!0},$("#notifier").on("click",t.notifier.hide),this.showNotice=function(e,n,i){$("#notifier").find(".alert-title").text(e),$("#notifier").find(".alert-body").text(n),"success"==i?($("#notifier").removeClass("bg-warning"),$("#notifier").removeClass("bg-danger"),$("#notifier").addClass("bg-success")):"error"==i?($("#notifier").removeClass("bg-warning"),$("#notifier").addClass("bg-danger"),$("#notifier").removeClass("bg-success")):($("#notifier").addClass("bg-warning"),$("#notifier").removeClass("bg-danger"),$("#notifier").removeClass("bg-success")),t.notifier.show()},$(".unseen-notification").each(function(){t.showNotice($(this).attr("data-title"),$(this).text(),$(this).attr("data-status")),$(this).remove()}),this},t.notifier.show=function(){return t.notifierConfig.animation?$("#notifier").animate({opacity:1,top:"66px"}):$("#notifier").show(),this},t.notifier.hide=function(){return t.notifierConfig.animation?$("#notifier").animate({opacity:0,top:0}):$("#notifier").hide(),this},t.notifier.resize=function(){return $("#notifier").css({left:$(".card:first").offset().left+"px",right:$(".card:first").offset().left+"px",maxWidth:$(".card:first").css("width")}),this},t}((App=function(t){"use strict";return $(document).ajaxStart(function(){t.showLoader()}),$(document).ajaxStop(function(){t.hideLoader()}),$(document).ajaxError(function(e,n,i,o){t.showNotice("Event Error",o,"error"),t.hideLoader()}),t.connector=function(){return this.showLoader=function(){$("#loader").show()},this.hideLoader=function(){$("#loader").hide()},this.testConnection=function(t,e){$.ajax({data:t,method:"post",url:"/test-connection",complete:function(t){console.log(t.responseText);var n=JSON.parse(t.responseText);e(n)}})},this.saveConnectionParams=function(t,e,n){$.ajax({data:t,method:"post",url:"/save-connection-params",complete:function(t){void 0===n&&(n=JSON.parse(t.responseText)),e(n)}})},this.hideLoader(),this},t}((App=function(t){"use strict";return t.config=function(){return $(".auth-type-container").hide(),$("select").select2(),$("#git-source-select").on("change",function(){$("form#connection-config").find("input").each(function(){this.value=""})}),$("#git-source-select").on("change",function(t){var e=$("option:selected",t.target);$("#git-api-url").val($(e).attr("data-api-url")),$("#git-file-url").val($(e).attr("data-file-url"))}),$("#git-source-auth").on("change",function(){var t=$('div[data-for="'+$(this).val()+'"]');$(".auth-type-container").hide(),$("input",$(t)).attr("required","required"),$(t).show()}),$("#connection-test, #config-save").on("click",t=>{$(t.target).closest("form").find('button[type="submit"]').removeClass("active"),$(t.target).addClass("active")}),$("form#connection-config").on("submit",function(e){e.preventDefault();var n=t.buildConnectionParams();if(!0===n[0])if($("#connection-test").hasClass("active"))$("#connection-test").attr("disabled","disabled"),$("#connection-test").text("...testing..."),t.testConnection(n[1],t.allowConfigSave);else{if(!$("#config-save").hasClass("active"))return!1;$("#config-save").attr("disabled","disabled"),$("#config-save").text("...saving..."),t.saveConnectionParams(n[1],t.redirect,{url:"/repos"})}else t.notifier().showNotice("Missing Data","There appears to be data missing to make a connection","error");return!1}),this.buildConnectionParams=function(){var t={},e=!0;$('.auth-type-container[data-for="'+$("#git-source-auth").val()+'"]').find("input").map(function(){""==$.trim(this.value)&&(e=!1),t[this.name]=$.trim(this.value)}),""==$.trim($("#git-api-url").val())&&(e=!1);var n={"git-source-select":$("#git-source-select").val(),"git-source-auth":$("#git-source-auth").val(),"git-api-url":$("#git-api-url").val(),"git-credentials":t};return[e,n]},this.allowConfigSave=function(e){console.log(e);var n=!1;e.success&&""==e.warnings?(t.showNotice("Connection Test","Connected test succeeded","success"),n=!0):e.msgs.length>0?t.showNotice("Connection Error",e.msgs.join("<br />"),"error"):e.warnings.length>0?(t.showNotice("Connection Test","Connected test succeeded: "+e.warnings,"warning"),n=!0):t.showNotice("Connection Error","Unknown response","error"),n&&($("button#config-save").removeClass("hidden"),$("button#config-save").trigger("focus")),$("button#connection-test").removeAttr("disabled"),$("button#connection-test").text("Test Connection")},{allowConfigSave:this.allowConfigSave}},t}(App||{}))||{}))||{}))||{});